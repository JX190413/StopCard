<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--这个是要引用的SQL语句类型文件夹-->
<mapper namespace="com.cykj.stopcard.dao.AdminLoginDao">




<!--    后台管理员登录-->
<resultMap id="Worker" type="Worker"></resultMap>
 <select id="queryAdmin" parameterType="Worker" resultMap="Worker">

 SELECT a.*,b.statename
 FROM tbl_worker a,tbl_state b
where workeraccount=#{workeraccount}
and workerpass=#{workerpass} and a.stateid=b.stateid

 </select>

<!--    查询角色菜单-->
<resultMap id="AdminMenu" type="AdminMenu"></resultMap>
<select id="queryMenu" parameterType="Worker"  resultMap="AdminMenu">
SELECT g.workerid,g.workeraccount,g.statename,g.menuname  fathername,h.menuname chilename,h.menuurl menuurl from (SELECT a.workerid, a.workeraccount,f.statename,b.menuname,d.menuid,b.fatherid,b.menuurl from tbl_worker a,tbl_menu b,tbl_role c,tbl_rolemenu d,tbl_workeroler e,tbl_state f
where a.workerid=e.workerid
and e.rolerid=c.roleid
and c.roleid=d.roleid
and d.menuid=b.menuid
and a.stateid=f.stateid) g,(SELECT a.workerid, a.workeraccount,f.statename,b.menuname,d.menuid,b.fatherid,b.menuurl from tbl_worker a,tbl_menu b,tbl_role c,tbl_rolemenu d,tbl_workeroler e,tbl_state f
where a.workerid=e.workerid
and e.rolerid=c.roleid
and c.roleid=d.roleid
and d.menuid=b.menuid
and a.stateid=f.stateid) h
where g.menuid=h.fatherid
and g.workeraccount=#{workeraccount}
</select>
<!-- 人脸识别-->

 <!-- 查询所有的用户 -->
 <select id="selectAllUsers" resultMap="Worker" >
		select * from tbl_worker
	</select>
<!--添加工作人员-->
 <insert id="saveUser"  parameterType="Worker"  >
		insert into tbl_worker (workeraccount,workerpass,stateid,face) values (#{workeraccount},#{workerpass},1,#{face,typeHandler=org.apache.ibatis.type.BlobTypeHandler})
	</insert>
<!--查询所有工作人员-->
    <select id="queryWorker" parameterType="Worker" resultMap="Worker">
        select * from
        (select f.workeraccount,g.rolename,f.statename,f.worktime from
        (select c.workerid,c.workeraccount,c.statename,c.worktime,d.rolerid from
        (select a.workerid,a.workeraccount,a.worktime,b.statename from tbl_worker a,tbl_state b
        where a.stateid=b.stateid) c LEFT JOIN tbl_workeroler d
        on c.workerid=d.workerid) f LEFT JOIN tbl_role g
        on f.rolerid=g.roleid)  a

        <where>
            <if test="workeraccount!=null and workeraccount!=''" >
                and a.workeraccount=#{workeraccount}
            </if>

        </where>
        LIMIT #{page},5
    </select>
<!--查询所有工作人员条数-->
    <select id="queryPage" parameterType="Worker" resultMap="Worker">
        select * from
        (select f.workeraccount,g.rolename,f.statename,f.worktime from
        (select c.workerid,c.workeraccount,c.statename,c.worktime,d.rolerid from
        (select a.workerid,a.workeraccount,a.worktime,b.statename from tbl_worker a,tbl_state b
        where a.stateid=b.stateid) c LEFT JOIN tbl_workeroler d
        on c.workerid=d.workerid) f LEFT JOIN tbl_role g
        on f.rolerid=g.roleid)  a

        <where>
            <if test="workeraccount!=null and workeraccount!=''" >
                and a.workeraccount=#{workeraccount}
            </if>

        </where>
    </select>


    <!--    自助设备表格分页查询与带条件搜索-->
    <select id="devictb" parameterType="devic" resultType="devic">
        select a.deviceid devicid,a.devicearea,a.devicname,a.devictime,b.statename
        from tbl_devic a, tbl_state b
        <where>a.devicstate=b.stateid
            <if test="devicname != null and devicname != ''">
                and a.devicname LIKE #{devicname}
            </if>
        </where>
        limit #{page},5
    </select>

    <!--    //自助设备表格查询-->
    <select id="devictbzong" parameterType="devic" resultType="devic">
        SELECT a.deviceid devicid,a.devicearea,a.devicname,a.devictime,b.statename
        from tbl_devic a, tbl_state b
        <where>a.devicstate=b.stateid</where>
    </select>

    <!--    //自助设备添加重复查询-->
    <select id="repeatevic" parameterType="devic" resultType="devic">
        select a.devicearea,a.devicname
        from tbl_devic a
        where a.devicearea=#{devicearea}
        and a.devicname=#{devicname}
    </select>

    <!--    //自助设备增加-->
    <insert id="adddevic" parameterType="devic" >
     insert into tbl_devic (devicearea,devicname,devicstate,devictime)
     values (#{devicearea},#{devicname},1,#{devictime})
    </insert>

    <!--    //自助设备删除-->
    <delete id="deletedevic" parameterType="devic" >
           delete from tbl_devic where deviceid=#{devicid}
    </delete>


    <!--    //自助设备修改-->
    <update id="revisedevic" parameterType="devic" >
          update tbl_devic
        set devicearea=#{devicearea} ,devicname=#{devicname} where deviceid=#{devicid}

    </update>


    <!--    //自助设备状态修改-->
    <update id="state" parameterType="devic" >
        update tbl_devic
        set devicstate=#{state} where deviceid=#{devicid}
    </update>


    <!--    //月缴产品管理表格分页查询与带条件搜索-->
    <select id="MonthlyPaymenttb" parameterType="combo" resultType="combo">
        select *
        from tbl_combo a
        <where>a.comboid=a.comboid
            <if test="combotime != null and combotime != ''">
                and a.combotime LIKE #{combotime}
            </if>
        </where>
        limit #{page},5
    </select>

    <!--    //月缴产品管理表格总条数查询-->
    <select id="MonthlyPaymentzong" parameterType="combo" resultType="combo">
        select *
        from tbl_combo a

    </select>

    <!--    //月缴产品添加重复查询-->
    <select id="repeatMonthlyPayment" parameterType="combo" resultType="combo">
        select a.combotime
        from tbl_combo a
        where a.combotime=#{combotime}

    </select>

    <!--    //月缴产品增加-->
    <insert id="addMonthlyPayment" parameterType="combo" >
     insert into tbl_combo(combotime,combomoney)
     values (#{combotime},#{combomoney})
    </insert>

    <!--    //月缴产品删除-->
    <delete id="deMonthlyPayment" parameterType="combo" >
           delete from tbl_combo where comboid=#{comboid}
    </delete>

<!--    临时停车缴费收支查询-->
    <select id="ECharts" resultType="Cost">
      SELECT b.paytype,a.money
      FROM tbl_inout a,tbl_pay b
      WHERE a.payid=b.payid
      AND a.payid=2
    </select>

<!--    月产品收入查询-->
    <select id="EChartsmonth" resultType="Cost">
      SELECT a.sellmoney,b.combotime
      FROM tbl_sell a,tbl_combo b
      WHERE a.comboid=b.comboid

    </select>

<!--    //车辆离场缴费状态修改-->
    <update id="Paygai"  parameterType="pay">
        update tbl_inout
        set  stateid=5 where inoutid=#{out_trade_no}
    </update>


</mapper>
