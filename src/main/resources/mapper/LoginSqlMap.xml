<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--这个是要引用的SQL语句类型文件夹-->
<mapper namespace="com.cykj.stopcard.dao.AdminLoginDao">




<!--    后台管理员登录-->
<resultMap id="Worker" type="Worker"></resultMap>
 <select id="queryAdmin" parameterType="Worker" resultMap="Worker">

 SELECT a.*,b.statename
 FROM tbl_worker a,tbl_state b
where workeraccount=#{workeraccount}
and workerpass=#{workerpass} and a.stateid=b.stateid

 </select>

<!--    查询角色菜单-->
<resultMap id="AdminMenu" type="AdminMenu"></resultMap>
<select id="queryMenu" parameterType="Worker"  resultMap="AdminMenu">
SELECT g.workerid,g.workeraccount,g.statename,g.menuname  fathername,h.menuname chilename,h.menuurl menuurl from (SELECT a.workerid, a.workeraccount,f.statename,b.menuname,d.menuid,b.fatherid,b.menuurl from tbl_worker a,tbl_menu b,tbl_role c,tbl_rolemenu d,tbl_workeroler e,tbl_state f
where a.workerid=e.workerid
and e.rolerid=c.roleid
and c.roleid=d.roleid
and d.menuid=b.menuid
and a.stateid=f.stateid) g,(SELECT a.workerid, a.workeraccount,f.statename,b.menuname,d.menuid,b.fatherid,b.menuurl from tbl_worker a,tbl_menu b,tbl_role c,tbl_rolemenu d,tbl_workeroler e,tbl_state f
where a.workerid=e.workerid
and e.rolerid=c.roleid
and c.roleid=d.roleid
and d.menuid=b.menuid
and a.stateid=f.stateid) h
where g.menuid=h.fatherid
and g.workeraccount=#{workeraccount}
</select>
<!-- 人脸识别-->

 <!-- 查询所有的用户 -->
 <select id="selectAllUsers" resultMap="Worker" >
		select * from tbl_worker
	</select>
<!--添加工作人员-->
 <insert id="saveUser"  parameterType="Worker"  >
		insert into tbl_worker (workeraccount,workerpass,stateid,face) values (#{workeraccount},#{workerpass},1,#{face,typeHandler=org.apache.ibatis.type.BlobTypeHandler})
	</insert>
<!--查询所有工作人员-->
    <select id="queryWorker" parameterType="Worker" resultMap="Worker">
        select * from
        (select f.workeraccount,g.rolename,f.statename,f.worktime from
        (select c.workerid,c.workeraccount,c.statename,c.worktime,d.rolerid from
        (select a.workerid,a.workeraccount,a.worktime,b.statename from tbl_worker a,tbl_state b
        where a.stateid=b.stateid) c LEFT JOIN tbl_workeroler d
        on c.workerid=d.workerid) f LEFT JOIN tbl_role g
        on f.rolerid=g.roleid)  a

        <where>
            <if test="workeraccount!=null and workeraccount!=''" >
                and a.workeraccount=#{workeraccount}
            </if>

        </where>
        LIMIT #{page},5
    </select>
<!--查询所有工作人员条数-->
    <select id="queryPage" parameterType="Worker" resultMap="Worker">
        select * from
        (select f.workeraccount,g.rolename,f.statename,f.worktime from
        (select c.workerid,c.workeraccount,c.statename,c.worktime,d.rolerid from
        (select a.workerid,a.workeraccount,a.worktime,b.statename from tbl_worker a,tbl_state b
        where a.stateid=b.stateid) c LEFT JOIN tbl_workeroler d
        on c.workerid=d.workerid) f LEFT JOIN tbl_role g
        on f.rolerid=g.roleid)  a

        <where>
            <if test="workeraccount!=null and workeraccount!=''" >
                and a.workeraccount=#{workeraccount}
            </if>

        </where>
    </select>

</mapper>
