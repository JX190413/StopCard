<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cykj.stopcard.dao.ChargeDao">
    <!--查询计费的时段等-->
    <select id="selfasttime" resultType="com.cykj.stopcard.bean.Product">
        SELECT * from tbl_rules c where c.mealid<![CDATA[<= ]]>4
</select>
    <select id="selall" resultMap="epmap" parameterType="com.cykj.stopcard.bean.Page">
        SELECT * FROM tbl_carport a,tbl_state c where  c.stateid=a.stateid AND a.portarea LIKE "%"#{where}"%" ORDER BY portid  LIMIT #{page},#{limit}
    </select>
    <resultMap id="epmap" type="com.cykj.stopcard.bean.CardPort">
        <result property="portid" column="portid"></result>
        <result property="portcardid" column="portcardid"></result>
        <result property="portarea" column="portarea"></result>
        <result property="portname" column="portname"></result>
        <result property="stateid" column="stateid"></result>
        <result property="portx" column="portx"></result>
        <result property="porty" column="porty"></result>
        <result property="carnum" column="carnum"></result>
        <result property="statename" column="statename"></result>

    </resultMap>
    <select id="selcormid" parameterType="java.lang.String" resultType="Integer">
        SELECT comboid from tbl_combo  where  combotime=#{time}
    </select>
    <!--增加订单-->
    <insert id="inserole" parameterType="Business">
INSERT INTO tbl_business(comboid,paytime,pasttime,carnum,cartype)VALUES
(#{comboid},#{paytime},#{pasttime},#{carnum},'待缴费')
    </insert>
    <!--联查时间段的金钱-->
    <select id="selcomboid" resultType="com.cykj.stopcard.bean.Combo" parameterType="java.lang.String">
        SELECT * from tbl_combo where combotime=#{time}
    </select>
    <!--查询订单id-->
    <select id="selodnumber" parameterType="java.lang.String" resultType="int">
       SELECT businessid from tbl_business where carnum=#{carnum}
    </select>
    <!--查询车主的已缴费的订单-->
    <select id="selhuiyuan" resultType="com.cykj.stopcard.bean.Business" parameterType="java.lang.String" >
       SELECT * from tbl_business a WHERE a.cartype='已缴费' and a.carnum=#{carnum}
    </select>
    <!--车主未付款时删除之前车主的订单-->
    <delete id="delall" parameterType="java.lang.String">
        DELETE from tbl_business  where carnum=#{carnum}
    </delete>
    <!--扫码成功后修改订单状态-->
    <update id="uptype" parameterType="java.lang.String">
UPDATE tbl_business set cartype='已缴费' where businessid=#{ID}
    </update>
    <select id="selallnumber" resultType="int" parameterType="java.lang.String">
       select COUNT(*) from tbl_carport where portarea LIKE "%"#{where}"%"
    </select>
    <select id="selcarid" parameterType="java.lang.String" resultType="Integer">
        SELECT stateid from tbl_state WHERE statename=#{statename}
    </select>
    <update id="upcartype" parameterType="com.cykj.stopcard.bean.CardPort" >
        UPDATE tbl_carport SET stateid=#{stateid} where portarea=#{portarea}
    </update>
    <select id="selmoney" parameterType="java.lang.String" resultType="com.cykj.stopcard.bean.Cost">
        SELECT a.money from tbl_inout a WHERE a.outtime &lt; #{nexttime} and a.intime &gt; #{fasttime}
    </select>
    <insert id="insetdaile" parameterType="java.lang.String">
        INSERT into tbl_daile (dailetime,dailemoney) VALUES(#{dailetime} ,#{money})
    </insert>
    <select id="seldaile" resultType="Daile" parameterType="java.lang.String">
SELECT * from tbl_daile where dailetime like "%"#{nowday}"%"
    </select>
    <select id="selcarbo" resultType="Combo">
        SELECT * from tbl_combo
    </select>

</mapper>